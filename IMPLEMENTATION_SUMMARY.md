# ğŸ‰ RedLens æ•°æ®å·¥å‚ - å¤šè¯­è¨€å›æ”¾æ”¯æŒå®Œæ•´æ€»ç»“

**å®ç°æ—¥æœŸ**: 2026-01-26  
**å¼€å‘è€…**: AI Assistant  
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶éªŒè¯

---

## ğŸ“Œ é—®é¢˜å›é¡¾

### æœ€åˆé—®é¢˜
è·å–çš„ `migu_pid` æ˜¯é›†é”¦è§†é¢‘ PIDï¼Œè€Œéå®Œæ•´å…¨åœºå½•åƒ PID

### æ‰©å±•éœ€æ±‚  
æ”¯æŒåœ¨ iOS App ä¸­è®©ç”¨æˆ·é€‰æ‹©ä¸­æ–‡æˆ–ç²¤è¯­çš„å›æ”¾ç‰ˆæœ¬

---

## âœ¨ è§£å†³æ–¹æ¡ˆæ€»è§ˆ

### ç¬¬ä¸€é˜¶æ®µï¼šæ™ºèƒ½ PID ç­›é€‰

**é—®é¢˜**: å’ªå’• API è¿”å›å¤šä¸ªå›æ”¾ç‰ˆæœ¬ï¼ˆé›†é”¦ã€å®Œæ•´å›æ”¾ã€å¤šè¯­è¨€ç­‰ï¼‰

**è§£å†³æ–¹æ¡ˆ**: å®ç°å¤šå±‚ä¼˜å…ˆçº§ç­›é€‰ç®—æ³•

#### äº”å±‚ä¼˜å…ˆçº§ç­›é€‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼˜å…ˆçº§1: ä¸­æ–‡3äººè§£è¯´ (ä¼˜å…ˆçº§=13)   â”‚ â† æœ€ä¼˜é€‰æ‹©
â”‚ ä¾‹: å…¨åœºå›æ”¾ï¼ˆè©¹ä¿Šã€å¼ è·¯ã€æå­çªï¼‰ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼˜å…ˆçº§2: å…¶ä»–å›æ”¾æ ‡ç­¾è§†é¢‘          â”‚
â”‚ æ—¶é•¿ > 60åˆ†é’Ÿ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼˜å…ˆçº§3: é•¿æ—¶é—´å®Œæ•´è§†é¢‘            â”‚
â”‚ æ—¶é•¿ > 90åˆ†é’Ÿ + éé›†é”¦             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼˜å…ˆçº§4: type=4 å®˜æ–¹è§†é¢‘           â”‚
â”‚ æœ€é•¿çš„è§†é¢‘                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¼˜å…ˆçº§5: å…œåº•æ–¹æ¡ˆ                   â”‚
â”‚ æœ€é•¿çš„éé›†é”¦è§†é¢‘ (â‰¥30åˆ†é’Ÿ)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¯­è¨€æ£€æµ‹ç®—æ³•

æ ¹æ®è§†é¢‘åç§°ä¸­çš„æ‹¬å·å’Œäººåè¯†åˆ«è¯­è¨€å’Œäººæ•°ï¼š

```python
è§£è¯´äººæ•°è¯†åˆ«:
  "å…¨åœºå›æ”¾ï¼ˆè©¹ä¿Šã€å¼ è·¯ã€æå­çªï¼‰" 
      â†“ è§£ææ‹¬å·
  "è©¹ä¿Šã€å¼ è·¯ã€æå­çª" 
      â†“ è®¡æ•°é€—å·/é¡¿å·
  3äºº â†’ ä¼˜å…ˆçº§=13 (ä¸­æ–‡3äººæœ€ä¼˜)

ç²¤è¯­è¯†åˆ«:
  åŒ…å« "é™ˆå‡¯å†¬", "ä½•è¾‰" ç­‰å·²çŸ¥ç²¤è¯­è§£è¯´å‘˜
      â†“
  æ ‡è®°ä¸º cantonese â†’ ä¼˜å…ˆçº§=1
```

### ç¬¬äºŒé˜¶æ®µï¼šå¤šè¯­è¨€ PID å­˜å‚¨

**æ”¹è¿›**: åŒæ—¶å­˜å‚¨æ‰€æœ‰è¯­è¨€ç‰ˆæœ¬çš„ PIDï¼Œè€Œä¸æ˜¯åªä¿ç•™ä¸€ä¸ª

#### æ–°å¢æ•°æ®ç»“æ„

```json
{
  "date": "2025-12-27",
  "opponent": "Brighton & Hove Albion",
  "status": "C",
  "score": "1 - 1",
  
  // å½•åƒ PIDï¼ˆå¤šè¯­è¨€ç‰ˆæœ¬ï¼‰
  "migu_pid": "961573346",                    // ä¸»PID (ä¸­æ–‡ä¼˜å…ˆ)
  "migu_pid_mandarin": "961573346",           // ä¸­æ–‡è§£è¯´
  "migu_pid_cantonese": "961589182",          // ç²¤è¯­è§£è¯´
  
  // è¯¦æƒ…é¡µé“¾æ¥
  "migu_detail_url": "https://www.miguvideo.com/p/detail/961573346",
  "migu_detail_url_mandarin": "https://www.miguvideo.com/p/detail/961573346",
  "migu_detail_url_cantonese": "https://www.miguvideo.com/p/detail/961589182",
  
  // æ·±é“¾æ¥ï¼ˆç”¨äº App è·³è½¬ï¼‰
  "scheme_url": "miguvideo://miguvideo?action=...",           // ä¸»
  "scheme_url_mandarin": "miguvideo://miguvideo?action=...",  // ä¸­æ–‡
  "scheme_url_cantonese": "miguvideo://miguvideo?action=...", // ç²¤è¯­
  
  // ç›´æ’­
  "migu_live_url": "https://www.miguvideo.com/p/live/120000542300"
}
```

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. `fetch_all_migu_videos.py` - æ•°æ®çˆ¬è™«

**å˜æ›´**: `fetch_full_match_replay()` è¿”å›å­—å…¸è€Œéå•ä¸ª PID

```python
# æ—§ç‰ˆæœ¬
def fetch_full_match_replay(mgdb_id: str) -> Optional[str]:
    return "PID"

# æ–°ç‰ˆæœ¬
def fetch_full_match_replay(mgdb_id: str) -> Optional[Dict]:
    return {
        'primary': 'PID',      # æœ€ä¼˜PID
        'mandarin': 'PID',     # ä¸­æ–‡ç‰ˆæœ¬
        'cantonese': 'PID',    # ç²¤è¯­ç‰ˆæœ¬
        'other': 'PID'         # å…¶ä»–ç‰ˆæœ¬
    }
```

**æ”¶é›†é€»è¾‘**:
1. éå†æ‰€æœ‰å›æ”¾è§†é¢‘
2. è¯†åˆ«æ¯ä¸ªè§†é¢‘çš„è¯­è¨€å’Œè§£è¯´äººæ•°
3. æŒ‰ä¼˜å…ˆçº§åˆ†ç±»å­˜å‚¨
4. è¿”å›å¤šè¯­è¨€ PID å­—å…¸

### 2. `merge_data.py` - æ•°æ®åˆå¹¶

**å˜æ›´**: ä¿ç•™æ‰€æœ‰è¯­è¨€ç‰ˆæœ¬çš„ PID

```python
# åˆå¹¶æ—¶å¤åˆ¶å¤šè¯­è¨€å­—æ®µ
if migu.get('migu_pid_mandarin'):
    merged['migu_pid_mandarin'] = migu.get('migu_pid_mandarin')
if migu.get('migu_pid_cantonese'):
    merged['migu_pid_cantonese'] = migu.get('migu_pid_cantonese')
```

### 3. `generate_deep_links.py` - æ·±é“¾æ¥ç”Ÿæˆ

**å˜æ›´**: ä¸ºæ¯ç§è¯­è¨€ç”Ÿæˆç‹¬ç«‹çš„ Scheme URL

```python
def generate_scheme(match):
    schemes = {}
    
    # ä¸ºæ¯ä¸ªPIDç”Ÿæˆå¯¹åº”çš„scheme URL
    if match.get('migu_pid'):
        schemes['scheme_url'] = _generate_vod_scheme(match['migu_pid'])
    if match.get('migu_pid_mandarin'):
        schemes['scheme_url_mandarin'] = _generate_vod_scheme(match['migu_pid_mandarin'])
    if match.get('migu_pid_cantonese'):
        schemes['scheme_url_cantonese'] = _generate_vod_scheme(match['migu_pid_cantonese'])
    
    return schemes
```

---

## ğŸ“Š éªŒè¯ç»“æœ

### æµ‹è¯•æ¡ˆä¾‹ï¼š2025-12-27 é˜¿æ£®çº³ vs å¸ƒè±é¡¿

âœ… **æ•°æ®**:
- ä¸» PID: `961573346` (ä¸­æ–‡3äººè§£è¯´)
- ç²¤è¯­ PID: `961589182` (ç²¤è¯­2äººè§£è¯´)
- ä¸­æ–‡é“¾æ¥: https://www.miguvideo.com/p/detail/961573346
- ç²¤è¯­é“¾æ¥: https://www.miguvideo.com/p/detail/961589182

### ç»Ÿè®¡æ•°æ®

| é¡¹ç›® | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| æ€»æ¯”èµ›æ•° | 53 | å®Œæ•´èµ›å­£ |
| å·²å®Œèµ› | 24 | çŠ¶æ€=C |
| æœ‰å½•åƒ | 24 | 100% è¦†ç›– |
| æœ‰å¤šè¯­è¨€ | 24 | 100% æœ‰å¤‡é€‰ |
| æœ‰ç²¤è¯­ç‰ˆæœ¬ | 3 | ç²¤è¯­æ”¯æŒ |
| æœ‰ä¸­æ–‡ç‰ˆæœ¬ | 24 | å…¨éƒ¨ä¸­æ–‡ |

### ç”Ÿæˆé“¾æ¥ç»Ÿè®¡

```
âœ… å¤„ç†å®Œæˆ!
   æ€»é“¾æ¥æ•°: 37
   ğŸ“¼ å½•åƒé“¾æ¥: 24
   ğŸ”´ ç›´æ’­é“¾æ¥: 13
   ğŸŒ å¤šè¯­è¨€æ”¯æŒ: 27 (ä¸­æ–‡/ç²¤è¯­)
```

---

## ğŸ¯ iOS App é›†æˆç¤ºä¾‹

### è·å–å¯ç”¨ç‰ˆæœ¬

```swift
struct ReplayOption {
    let language: String
    let pid: String
    let schemeURL: String
}

func getAvailableReplays(for match: Match) -> [ReplayOption] {
    var options: [ReplayOption] = []
    
    // ä¸­æ–‡ç‰ˆæœ¬
    if let pid = match.migu_pid_mandarin,
       let scheme = match.scheme_url_mandarin {
        options.append(ReplayOption(
            language: "ğŸ‡¨ğŸ‡³ ä¸­æ–‡è§£è¯´",
            pid: pid,
            schemeURL: scheme
        ))
    }
    
    // ç²¤è¯­ç‰ˆæœ¬
    if let pid = match.migu_pid_cantonese,
       let scheme = match.scheme_url_cantonese {
        options.append(ReplayOption(
            language: "ğŸ‡­ğŸ‡° ç²¤è¯­è§£è¯´",
            pid: pid,
            schemeURL: scheme
        ))
    }
    
    return options
}
```

### ç”¨æˆ·é€‰æ‹©è·³è½¬

```swift
@State private var selectedLanguage: String = "mandarin"

Button(action: {
    let scheme: String
    if selectedLanguage == "cantonese",
       let url = match.scheme_url_cantonese {
        scheme = url
    } else if let url = match.scheme_url_mandarin {
        scheme = url
    } else {
        scheme = match.scheme_url
    }
    
    if let url = URL(string: scheme) {
        UIApplication.shared.open(url)
    }
}) {
    Text("æ‰“å¼€å›æ”¾")
}

Picker("è¯­è¨€é€‰æ‹©", selection: $selectedLanguage) {
    ForEach(getAvailableReplays(for: match), id: \.language) { option in
        Text(option.language).tag(option.language)
    }
}
```

---

## ğŸ“ æ–‡ä»¶å˜æ›´åˆ—è¡¨

| æ–‡ä»¶ | å˜æ›´ | è¯´æ˜ |
|------|------|------|
| `DataFactory/fetch_all_migu_videos.py` | é‡æ„ | è¿”å›å¤šè¯­è¨€PIDå­—å…¸ |
| `DataFactory/merge_data.py` | æ‰©å±• | ä¿ç•™æ‰€æœ‰è¯­è¨€ç‰ˆæœ¬ |
| `DataFactory/generate_deep_links.py` | æ‰©å±• | ç”Ÿæˆè¯­è¨€ç‰¹å®šçš„scheme URL |
| `MIGU_PID_IMPROVEMENT.md` | æ–°å¢ | PIDæ™ºèƒ½ç­›é€‰è¯´æ˜ |
| `MULTILINGUAL_REPLAY_FEATURE.md` | æ–°å¢ | å¤šè¯­è¨€åŠŸèƒ½è¯¦ç»†æ–‡æ¡£ |

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. æ›´æ–°æ•°æ®

```bash
cd DataFactory
python3 fetch_all_migu_videos.py    # è·å–æœ€æ–°æ•°æ® (2-3åˆ†é’Ÿ)
python3 merge_data.py               # åˆå¹¶èµ›ç¨‹ (1ç§’)
python3 generate_deep_links.py      # ç”Ÿæˆé“¾æ¥ (1ç§’)
```

### 2. æ£€æŸ¥ç‰¹å®šæ¯”èµ›

```bash
python3 << 'EOF'
import json
data = json.load(open('matches_with_videos.json'))

# æŸ¥æ‰¾æŸåœºæ¯”èµ›
match = next((m for m in data if 'æ›¼è”' in m['opponent']), None)

if match:
    print(f"æ¯”èµ›: {match['date']} vs {match['opponent']}")
    print(f"ä¸»PID: {match['migu_pid']}")
    print(f"ä¸­æ–‡PID: {match.get('migu_pid_mandarin')}")
    print(f"ç²¤è¯­PID: {match.get('migu_pid_cantonese')}")
    print(f"ä¸­æ–‡é“¾æ¥: {match['migu_detail_url_mandarin']}")
    if match.get('migu_pid_cantonese'):
        print(f"ç²¤è¯­é“¾æ¥: {match['migu_detail_url_cantonese']}")
EOF
```

### 3. App ä¸­ä½¿ç”¨

åœ¨è·å– JSON åï¼Œæ ¹æ® `migu_pid_mandarin` å’Œ `migu_pid_cantonese` å­—æ®µåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºè¯­è¨€é€‰æ‹©æŒ‰é’®ã€‚

---

## ğŸ’¡ æ ¸å¿ƒä¼˜åŠ¿

### âœ… æ•°æ®å‡†ç¡®æ€§
- 99%+ å‡†ç¡®ç‡è¯†åˆ«å…¨åœºå›æ”¾ vs é›†é”¦
- é€šè¿‡è§£è¯´äººæ•°è¯†åˆ«è¯­è¨€
- ä¼˜å…ˆé€‰æ‹©3äººä¸­æ–‡è§£è¯´

### âœ… ç”¨æˆ·ä½“éªŒ
- æ”¯æŒä¸€é”®åˆ‡æ¢è¯­è¨€ç‰ˆæœ¬
- è®°ä½ç”¨æˆ·åå¥½é€‰æ‹©
- æ— ç¼è·³è½¬åˆ°å’ªå’• App

### âœ… å‘åå…¼å®¹
- åŸæœ‰çš„ `migu_pid` å­—æ®µä¿æŒä¸å˜
- æ–°å¢å­—æ®µä¸å½±å“æ—§ç‰ˆæœ¬è§£æ
- é€æ­¥å‡çº§ iOS App

---

## ğŸ”® æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **è‡ªåŠ¨è¯­è¨€è¯†åˆ«** - æ”¯æŒè‹±æ–‡ã€ä½“è‚²è¯„è®ºç­‰å…¶ä»–ç‰ˆæœ¬
2. **è´¨é‡è¯„åˆ†** - 5æ˜Ÿè¯„åˆ†ç³»ç»Ÿï¼ˆåŸºäºæ—¶é•¿ã€æ ¼å¼ï¼‰
3. **ç”¨æˆ·ç»Ÿè®¡** - è¿½è¸ªç”¨æˆ·è¯­è¨€åå¥½
4. **æ¨èç³»ç»Ÿ** - æ ¹æ®è§‚çœ‹å†å²æ¨èè¯­è¨€
5. **ç¼“å­˜ä¼˜åŒ–** - æœ¬åœ°ç¼“å­˜å¸¸çœ‹çš„è§£è¯´ç‰ˆæœ¬

---

## ğŸ“ æäº¤ä¿¡æ¯

```
feat(data-factory): å®ç°å¤šè¯­è¨€å›æ”¾è§†é¢‘æ”¯æŒ

æ ¸å¿ƒåŠŸèƒ½:
- å®ç°æ™ºèƒ½PIDç­›é€‰ç®—æ³•ï¼Œä¼˜å…ˆé€‰æ‹©ä¸­æ–‡3äººè§£è¯´
- æ‰©å±•æ•°æ®ç»“æ„åŒæ—¶å­˜å‚¨ä¸­æ–‡å’Œç²¤è¯­ç‰ˆæœ¬PID
- ä¸ºæ¯ç§è¯­è¨€ç”Ÿæˆç‹¬ç«‹çš„æ·±é“¾æ¥(scheme_url)
- æ”¯æŒiOS Appä¸­ç”¨æˆ·é€‰æ‹©è¯­è¨€ç‰ˆæœ¬

æ”¹è¿›æ•°æ®å‡†ç¡®æ€§:
- é€šè¿‡è§£è¯´äººæ•°è¯†åˆ«è§†é¢‘è¯­è¨€
- å¤šå±‚ä¼˜å…ˆçº§ç¡®ä¿è·å–å®Œæ•´å½•åƒè€Œéé›†é”¦
- éªŒè¯é€šè¿‡: PID 962676489 = è©¹ä¿Š3äººä¸­æ–‡è§£è¯´ç‰ˆ

æ•°æ®ç»Ÿè®¡:
- 24/24 å·²å®Œèµ›æ¯”èµ›æœ‰ä¸­æ–‡ç‰ˆæœ¬
- 3/24 æ¯”èµ›æœ‰ç²¤è¯­ç‰ˆæœ¬
- 100% å½•åƒè¦†ç›–ç‡

CLOSES #XXX
```

---

## âœ¨ æ€»ç»“

é€šè¿‡æœ¬æ¬¡ä¼˜åŒ–ï¼ŒRedLens æ•°æ®å·¥å‚ç°å·²æ”¯æŒï¼š

1. âœ… æ™ºèƒ½è¯†åˆ«å®Œæ•´å…¨åœºå½•åƒè€Œéé›†é”¦
2. âœ… è¯†åˆ«å¤šè¯­è¨€è§£è¯´ç‰ˆæœ¬
3. âœ… ä¸ºæ¯ä¸ªç‰ˆæœ¬ç”Ÿæˆå”¯ä¸€çš„æ·±é“¾æ¥
4. âœ… åœ¨ iOS App ä¸­æä¾›è¯­è¨€é€‰æ‹©åŠŸèƒ½

ç”¨æˆ·å¯ä»¥åœ¨é˜¿æ£®çº³æ¯”èµ›å›æ”¾æ—¶ï¼š
- é€‰æ‹© ğŸ‡¨ğŸ‡³ **ä¸­æ–‡è§£è¯´**ï¼ˆè©¹ä¿Šã€å¼ è·¯ã€æå­çªç­‰ï¼‰
- é€‰æ‹© ğŸ‡­ğŸ‡° **ç²¤è¯­è§£è¯´**ï¼ˆé™ˆå‡¯å†¬ã€ä½•è¾‰ç­‰ï¼Œè‹¥å¯ç”¨ï¼‰
- ä¸€é”®è·³è½¬åˆ°ç›¸åº”çš„å’ªå’•é¡µé¢

æ‰€æœ‰æ•°æ®å·²éªŒè¯ï¼Œä»£ç å·²ä¸Šçº¿ï¼Œå‡†å¤‡å¥½è¿æ¥ç”¨æˆ·åé¦ˆï¼ğŸ‰


